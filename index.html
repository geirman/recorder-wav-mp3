<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Building a JS Constructor</title>
 
    <!-- Bootstrap -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet">

    <style>
        #recordings > div {
            margin-top: 20px;
            border-top: 1px dotted black;
            /*border-bottom: 1px dotted black;*/
            padding: 10px 0px;
        }

        audio ~ a {
            display: block;
        }
    </style>
 
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="//oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="//oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body class="container">
    <h1>Building a JS Constructor</h1>
    <div>
        <button class="btn btn-primary" onclick="startRec(this)">Record</button>
        <button class="btn btn-danger" onclick="stopRec(this)" disabled>Stop</button>
    </div>

    <div id="recordings">

    </div>
 
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="recorder.js"></script>
    <script>

    var cfg = {};
    var audio = new Recorder(cfg);

    function startRec( btn ){
        // audio && audio.record();
        audio.record();
        btn.disabled = true;
        btn.nextElementSibling.disabled = false;
    }

    function stopRec( btn ){
        // audio && audio.stop();
        audio.stop();
        btn.disabled = true;
        btn.previousElementSibling.disabled = false;

        createPreview( 'recordings' );
        audio.clear();
    }

    function createPreview( containerId ) {
        // audio && audio.exportWAV( function(blob) {

        var targetContainer = document.getElementById( containerId );
        var timestamp = new Date().getTime();
        var filename = 'recording_'+ timestamp;
        var div = document.createElement('div');

        var linkMP3 = document.createElement('a');
            linkMP3.setAttribute('id', 'MP3-'+ timestamp);
        
        var linkWAV = document.createElement('a');
            linkWAV.setAttribute('id', 'WAV-'+ timestamp);

        var player = document.createElement('audio');
            player.setAttribute('id', 'PLAYER-'+ timestamp);
            player.controls = true;
        
        div.appendChild(player);
        div.appendChild(linkMP3);
        div.appendChild(linkWAV);
        targetContainer.appendChild(div);
        
        audio.exportWAV( function( mediaObj ) {

            if( mediaObj.blob.type == 'audio/mp3' ){

                var url = mediaObj.url;
                targetPlayer = document.getElementById( 'PLAYER-'+ timestamp );
                targetLink = document.getElementById( 'MP3-'+ timestamp );
                
                targetPlayer.src = url;
                targetLink.href = url;
                targetLink.download = filename +'.mp3';
                targetLink.innerHTML = targetLink.download;
              
            } else {

                var url = URL.createObjectURL( mediaObj.blob );
                targetLink = document.getElementById( 'WAV-'+ timestamp );
                
                targetLink.href = url;
                targetLink.download = filename +'.wav';
                targetLink.innerHTML = targetLink.download;

            }
        });
    }


 
    </script>
  </body>
</html>
                                